<scrpit src="swapi/static/characters/swapi.js" />
<table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Birth Year</th>
        <th>Gender</th>
        <th>Homeworld</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="table-body">
      {% for character in object_list %}
      <tr>
        <td>{{ character.name }}</td>
        <td>{{ character.birth_year }}</td>
        <td>{{ character.gender }}</td>
        <td>{{ character.homeworld }}</td>
        <td>{{ character.date }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button id="load-more-btn" class="btn btn-primary">Load more</button>

{% block javascript %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
    var page = 1;
    var isLoading = false;

    $('#load-more-btn').click(function() {
    if (isLoading) {
        return;
    }
    isLoading = true;

    // Show a loading spinner
    $('#load-more-btn').html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...');

    // Make an AJAX request to fetch more data
    $.ajax({
        url: 'swapi/etl/',
        data: {
        page: page + 1
        },
        success: function(data) {
        // Hide the loading spinner
        $('#load-more-btn').html('Load more');
        isLoading = false;

        // Append the new data to the table
        var html = '';
        for (var i = 0; i < data.characters.length; i++) {
            var character = data.characters[i];
            html += '<tr>';
            html += '<td>' + character.name + '</td>';
            html += '<td>' + character.birth_year + '</td>';
            html += '<td>' + character.gender + '</td>';
            html += '<td>' + character.homeworld + '</td>';
            html += '<td>' + character.date + '</td>';
            html += '</tr>';
        }
        $('#table-body').append(html);

        // Increment the page counter
        page++;
        },
        error: function() {
        alert('Failed to load more data.');
        // Hide the loading spinner
        $('#load-more-btn').html('Load more');
        isLoading = false;
        }
    });
    });
});
</script>

{% endblock javascript %}
